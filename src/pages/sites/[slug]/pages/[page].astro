---
import Paginator from '@components/Paginator.astro';
import Post from '@components/Post.astro';
import Layout from '@layouts/Layout.astro';
import { getSite } from '@lib/supabase/get-site';

export const getStaticPaths = async () => {
  const pages = await getSite();
  return pages.map(({ pages, ...site }) =>
    pages.map((page) => ({
      params: { slug: site.slug, page: page.current },
      props: { site, page },
    })),
  );
};

type GetStaticPaths = Awaited<ReturnType<typeof getStaticPaths>>;
type Props = NonNullable<GetStaticPaths>[number][number]['props'];

const { site, page } = Astro.props;
---

<Layout>
  <div class="mt-fluid-2 flex flex-col gap-fluid-4">
    <h1 class="text-brand-1 text-2xl">{site.name}</h1>
    <section>
      <ul class="grid grid-cols-1 gap-4 md:grid-cols-2">
        {
          page.posts.map((post) => (
            <li>
              <Post
                siteName={site.name}
                link={post.link}
                title={post.title}
                pubDate={post.pub_date}
              />
            </li>
          ))
        }
      </ul>
    </section>
    <section>
      <Paginator
        current={page.current}
        isFirst={page.isFirst}
        isLast={page.isLast}
        prefix={`/sites/${site.slug}/`}
      />
    </section>
  </div>
</Layout>
